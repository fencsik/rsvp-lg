---
title: 'RSVPLG02: Generate Plots for Posters'
author: "David E. Fencsik"
date: "`r Sys.Date()`"
output:
  html_document:
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      dev = "pdf",
                      dpi = 72)
library(tidyverse)
this_file = "10-PlotsForPosters"
source_file = "02-FilterData"
dataFile = sprintf("%s.RData", source_file)
load(dataFile)
```

# Switch vs. Repeat Trials

Prepare data

```{r filterdata}
rsvpData |>
  filter(trial_type == "exp",
         t1_acc >= 0,
         t2_acc >= 0) |>
  mutate(switch_type=case_when(
           t1_level == t2_level ~ "noswitch",
           t1_level != t2_level ~ "switch",
           .default = NA)) |>
  filter(t1_acc == 1) |>
  group_by(sub, t2_level, switch_type) |>
  summarize(t2t1acc = mean(t2_acc),
            .groups="drop") -> x
```

Generate violin plots of overall repeating and switching

```{r ViolinPlotsByLevelAndSwitch, fig.height=4, fig.width=8}
x |>
  ggplot(aes(x=switch_type, y=t2t1acc)) +
  geom_violin(draw_quantiles=c(.25, .5, .75)) +
  geom_jitter(width=.15, height=0, color="black", shape="circle open") +
  geom_hline(yintercept=0.5, linetype=2, color="gray") +
  stat_summary(fun=mean, geom="point", color="red", shape="cross", size=5) +
  labs(x="Switch Condition", y="T2|T1 Accuracy") +
  scale_x_discrete(labels=c("noswitch"="No Switch", "switch"="Switch")) +
  facet_wrap(~t2_level, labeller=as_labeller(c(global="T2 Global", local="T2 Local"))) +
  theme_classic()
```

Generate violin plots of overall repeating and switching

```{r ViolinPlotsSwitchCostByLevel, fig.height=4, fig.width=4}
x |>
  pivot_wider(names_from=switch_type,
              values_from=t2t1acc) |>
  mutate(cost = noswitch - switch) -> switch.cost

switch.cost |>
  ggplot(aes(x=t2_level, y=cost)) +
  geom_violin(draw_quantiles=c(.25, .5, .75)) +
  geom_jitter(width=.15, height=0, color="black", shape="circle open") +
  geom_hline(yintercept=0, linetype=2, color="gray") +
  stat_summary(fun=mean, geom="point", color="red", shape="cross", size=5) +
  labs(x="T2 Level", y="No Switch - Switch (T2|T1 Accuracy)") +
  scale_x_discrete(labels=c("global"="Global", "local"="Local")) +
  theme_classic()
```

Add survey totals to switch.cost data

```{r AddSurveysToSwitchCost}
surveyData |>
  select(sub,
         bsam=sumbsam, sias6=sumsias6,
         promisd=sumpromisd, promisa=sumpromisa) |>
  right_join(switch.cost,
             by=join_by(sub),
             unmatched="error",
             relationship="one-to-many") -> switch.cost
```

Plot local and global switch cost as a function of PROMIS-A total

```{r ScatterplotSwitchCostByLevelAndPROMISA}
switch.cost |>
  ggplot(aes(x=promisa, y=cost, color=t2_level)) +
  geom_point(size=1) +
  geom_smooth(method="lm", formula=y~x, se=FALSE) +
  scale_color_manual(values=c("black","red")) +
  theme(legend.position="right",
        legend.title=element_blank()) +
  labs(x="Sum of PROMIS-A", y="No Switch - Switch (T2|T1 Accuracy)") +
  theme_classic()
```

Linear fit of global data above. Runs a regression of the effect of PROMIS-A on the difference score for just T2 global.

```{r RegressionSwitchCostByPROMISAforGlobal}
fit = lm(cost ~ promisa, data=switch.cost, subset=(t2_level == "global"))
summary(fit)
confint(fit, 'promisa', level=0.95)
```

Same as above but for T2 local.

```{r diffbypromisalm2}
fit = lm(cost ~ promisa, data=switch.cost, subset=(t2_level == "local"))
summary(fit)
confint(fit, 'promisa', level=0.95)
```
